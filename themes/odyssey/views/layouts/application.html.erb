<!doctype html>
<html class='no-js' lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>
      <%= "#{yield(:title)} Â» " if content_for?(:title) -%>
      <%= SETTINGS.name -%>: <%= SETTINGS.tagline -%>
    </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="Description" content="">
    <meta http-equiv="cleartype" content="on">

    <%= yield :open_graph_tags %>

    <%= csrf_meta_tag %>
    <link rel='search' type='application/opensearchdescription+xml' href='<%= "#{root_path}opensearch.xml" %>'  title='<%= SETTINGS.name %>' />

    <!-- Stylesheets, static -->
    <%= stylesheet_link_tag 'application', 'theme', :media => :all %>

    <link rel="stylesheet" href="https://d591zijq8zntj.cloudfront.net/leaflet-0.6.4/leaflet.css" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="https://d591zijq8zntj.cloudfront.net/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->

    <!-- Stylesheets, inserted  -->
    <%= yield :css_insert %>

    <!-- JavaScripts, static -->
    <%= javascript_include_tag(*mapping_js_includes) %>
    <%= javascript_include_tag 'application', 'theme', 'analytics' %>

    <!-- JavaScripts, inserted -->
    <%= yield :javascript_insert %>

    <!-- Auto-discovery, static -->
    <%= auto_discovery_link_tag(:atom, events_url(:format => 'atom'), :title => 'Atom: All Events' )%>

    <!-- Auto-discovery, inserted -->
    <%= yield :discovery_insert %>

    <%# FIXME extract icon into theme %>
    <link rel="apple-touch-icon" href="<%= image_path("site-icon.png") %>" />
    <link rel="author" href="humans.txt" />
  </head>
  <body class="<%= "#{controller.controller_name}_#{action_name}" %> <%= "#{controller.controller_name}_controller" %> <%= %w[new create edit update].include?(action_name) ? "#{controller.controller_name}_change" : "" %>">

    <div class='wrapper'>

      <header class='clearfix'>

          <div class='header-container'>
            <div class='project-menu'>
              <% if current_organization %>
                Logged in as: <%= current_organization.title %>
                (<%= link_to 'logout', organization_logout_path %>)
              <% elsif current_admin %>
                Logged in as Admin.
              <% end %>
            </div><!-- .project-menu -->

              <div class='logo clearfix'>
                <a class='logo-big' href="<%= root_path %>">
                  <%= image_tag('logo-big.svg') %>
                </a>
                <a class='logo-small' href="<%= root_path %>">
                  <%= image_tag('logo-small.svg') %>
                </a>
            </div><!-- .logo -->

            <div class='search-box-container clearfix'>
                <div class='search-box'>
                    <i class='button button--search button--white'></i>
                </div>
            </div><!-- .search-box-container -->
        </div><!-- .header-container -->

      </header>

      <div class='search-form'>
        <%= form_tag search_events_path, :method => :get do %>
          <% if request.env["HTTP_USER_AGENT"] && request.env["HTTP_USER_AGENT"].include?("Safari") %>
            <i class='fa fa-search'></i>
            <input placeholder="Search events" type="search" name="query" value="<%= @query %>" results="5" id="search_field">
          <% else %>
            <i class='fa-fa-search'></i>
            <%= text_field_tag 'query', @query, :id => 'search_field', :placeholder => 'Search events' %>
          <% end %>
        <% end -%>
      </div><!-- .search-form -->

      <nav>
        <ul class='app-menu clearfix'>
        <%= link_to events_path do %>
            <li class="<%=link_class[:events]%>">Events</li>
        <% end %>
        <%= link_to venues_path do %>
            <li class="<%=link_class[:venues]%>">Venues</li>
        <% end %>
        <%= link_to organizations_path do %>
            <li class="<%=link_class[:organizations]%>">Organizations</li>
        <% end %>
          <!-- <li class='<%=link_class[:events]%>'><%= link_to "Events", events_path %></li>
          <li class='<%=link_class[:venues]%>'><%= link_to "Venues", venues_path %></li>
          <li class='<%=link_class[:organizations]%>'><%= link_to "Organizations", organizations_path %></li> -->

        </ul><!-- .app-menu -->
      </nav>

      <% # Pick a subnav %>

      <%= render(:partial => 'events/subnav') if link_class[:events] == 'active' %>
      <%= render(:partial => 'venues/subnav') if link_class[:venues] == 'active' %>
      <%= render(:partial => 'organizations/subnav') if link_class[:organizations] == 'active' %>
      <%= render(:partial => 'sources/subnav') if link_class[:import] == 'active' %>

      <main role='main' class='content'>
        <%# flash[:success] = "yay"; flash[:failure] = "meh" %>
        <%= render_flash %>
        <%= yield %>
      </main>

      <!-- old is #top_footer -->
    <footer>
        <div class='footer-container'>
            <p><%= URI.parse(SETTINGS.url).host %></p>
        </div>
    </footer>

    </div>
  </body>
</html>
